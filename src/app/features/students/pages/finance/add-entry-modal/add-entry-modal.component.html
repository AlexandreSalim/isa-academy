<main>
  <section class="modal-content">
    @if (isEntrada) {
      <h1 class="title">Adicionar entrada</h1>
    }
    @if (isSaida) {
      <h1 class="title">Adicionar saída</h1>
    }

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form-list">
      <!-- Título -->
      <section class="sectionTitle">
        <label>Título</label>
        <input
          formControlName="title"
          placeholder="Ex.: Venda de suplemento"
          [class.invalid]="
            form.get('title')?.invalid && form.get('title')?.touched
          "
          />
          @if (form.get('title')?.invalid && form.get('title')?.touched) {
            <small
              class="error"
              >
              Título é obrigatório
            </small>
          }
        </section>

        <!-- Valor -->
        <section class="sectionTitle">
          <label>Valor (R$)</label>
          <input
            formControlName="value"
            type="number"
            min="0.01"
            step="0.01"
            placeholder="0,00"
          [class.invalid]="
            form.get('value')?.invalid && form.get('value')?.touched
          "
            />
            @if (form.get('value')?.invalid && form.get('value')?.touched) {
              <small
                class="error"
                >
                Valor deve ser maior que zero
              </small>
            }
          </section>

          <!-- Campos específicos para entrada (venda) -->
          @if (isEntrada) {
            <div style="display: none;">
              <section class="sectionDualInputs">
                <div class="sectionTitle">
                  <label>Quantidade</label>
                  <input formControlName="quantity" type="number" min="1" value="1" />
                </div>
                <div class="sectionTitle">
                  <label>Preço unitário</label>
                  <input
                    formControlName="unit_price"
                    type="number"
                    min="0.01"
                    step="0.01"
                    />
                  </div>
                </section>
              </div>
            }

            <!-- Campos específicos para saída (despesa) -->
            @if (isSaida) {
              <div style="display: none;">
                <section class="sectionTitle">
                  <label>Categoria</label>
                  <select formControlName="category">
                    @for (categoria of categorias; track categoria) {
                      <option
                        [value]="categoria.valor"
                        >
                        {{ categoria.label }}
                      </option>
                    }
                  </select>
                </section>
                <section class="sectionTitle">
                  <label>Observações</label>
                  <textarea
                    formControlName="notes"
                    placeholder="Opcional"
                    rows="2"
                  ></textarea>
                </section>
              </div>
            }

            <!-- Data -->
            <section class="sectionTitle">
              <label>Data *</label>
              <input formControlName="date" type="date" />
            </section>

            <!-- Método de pagamento -->
            <section class="sectionTitle" style="display: none;">
              <label>Método de pagamento</label>
              <select formControlName="payment_method">
                @for (metodo of metodosPagamento; track metodo) {
                  <option
                    [value]="metodo.valor"
                    >
                    {{ metodo.label }}
                  </option>
                }
              </select>
            </section>

            <!-- Repetição -->
            <section class="dualRadio">
              <div class="radio">
                <input
                  id="01"
                  type="radio"
                  formControlName="repeatMode"
                  value="none"
                  />
                  <label for="01">Não repetir</label>
                </div>

                <div class="radioSelect">
                  <div class="radio">
                    <input
                      id="02"
                      type="radio"
                      formControlName="repeatMode"
                      value="repeat"
                      />
                      <label for="02">Repetir mensalmente</label>
                    </div>

                    <select
                      formControlName="repeatInterval"
                      [disabled]="form.get('repeatMode')?.value === 'none'"
                      >
                      @for (mes of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]; track mes) {
                        <option
                          [value]="mes"
                          >
                          {{ mes }} {{ mes === 1 ? "mês" : "meses" }}
                        </option>
                      }
                    </select>
                  </div>
                </section>

                <!-- Dia da recorrência (apenas para despesas recorrentes) -->
                @if (isSaida && showRecurrenceDay) {
                  <section class="sectionTitle" style="display: none;">
                    <label>Dia da recorrência (1-31)</label>
                    <input
                      formControlName="recurrence_day"
                      type="number"
                      min="1"
                      max="31"
                      />
                    </section>
                  }

                  <div class="actions">
                    <button class="cancel" type="button" (click)="onCancel()">
                      Cancelar
                    </button>

                    <button
                      type="submit"
                      class="adicionar"
                      [disabled]="form.invalid"
                      [class.disabled]="form.invalid"
                      >
                      Adicionar
                    </button>
                  </div>
                </form>
              </section>
            </main>
