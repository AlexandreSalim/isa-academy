import{a as E}from"./chunk-B4CMSEAJ.js";import{Cc as k,E as v,H as I,j as Y,t as A,xb as $,yb as P}from"./chunk-7CCGUGHH.js";import{e as C}from"./chunk-JHI3MBHO.js";var T=(()=>{let a=class a{constructor(t){this.pickerCtrl=t,this.defaultMonthNames=["Janeiro","Fevereiro","Mar\xE7o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"]}open(){return C(this,arguments,function*(t={}){let n=new Date,u=n.getFullYear(),h=t.monthNames??this.defaultMonthNames,b=typeof t.initialMonth=="number"?t.initialMonth:n.getMonth(),g=t.initialYear??u,d=t.startYear??u-5,S=t.endYear??u+5,j=t.okText??"OK",D=t.cancelText??"Cancelar",F=h.map((e,r)=>({text:e,value:r})),N=[];for(let e=d;e<=S;e++)N.push({text:String(e),value:e});let J=Math.max(0,Math.min(N.length-1,g-d)),f,y,M=yield this.pickerCtrl.create({columns:[{name:"month",options:F,selectedIndex:b},{name:"year",options:N,selectedIndex:J}],buttons:[{text:D,role:"cancel"},{text:j,handler:e=>{try{if(e&&e.month!==void 0&&e.year!==void 0){f=Number(e.month?.value??e.month),y=Number(e.year?.value??e.year);return}if(Array.isArray(e)){let r=e.find(s=>s.name==="month"),o=e.find(s=>s.name==="year");r&&(f=Number(r.value??r.options?.[r.selectedIndex]?.value)),o&&(y=Number(o.value??o.options?.[o.selectedIndex]?.value));return}if(e&&e.values){f=Number(e.values.month??e.values.monthIndex),y=Number(e.values.year);return}}catch{}}}]});yield M.present();let{data:c,role:_}=yield M.onDidDismiss();if(_==="cancel")return null;if(f!=null&&y!=null){let e=Number(f),r=Number(y);if(!isNaN(e)&&!isNaN(r)&&e>=0&&e<=11)return{monthIndex:e,year:r,display:`${h[e]}/${r}`}}let i,l;try{let e=M;if(typeof e.getColumn=="function"){let r=e.getColumn("month"),o=e.getColumn("year");r&&r.options&&r.selectedIndex!=null&&(i=r.options[r.selectedIndex]?.value),o&&o.options&&o.selectedIndex!=null&&(l=o.options[o.selectedIndex]?.value)}if((i===void 0||l===void 0)&&typeof e.getColumns=="function"){let r=e.getColumns();if(Array.isArray(r)){let o=r.find(p=>p.name==="month"),s=r.find(p=>p.name==="year");o&&o.options&&o.selectedIndex!=null&&(i=i??o.options[o.selectedIndex]?.value),s&&s.options&&s.selectedIndex!=null&&(l=l??s.options[s.selectedIndex]?.value)}}if((i===void 0||l===void 0)&&c&&(c.values&&(i=i??c.values.month,l=l??c.values.year),i=i??c.month??c.values?.month,l=l??c.year??c.values?.year),(i===void 0||l===void 0)&&(e.columns||e.cols)){let r=e.columns||e.cols;if(Array.isArray(r)){let o=r.find(p=>p.name==="month"),s=r.find(p=>p.name==="year");o&&o.options&&o.selectedIndex!=null&&(i=i??o.options[o.selectedIndex]?.value),s&&s.options&&s.selectedIndex!=null&&(l=l??s.options[s.selectedIndex]?.value)}}}catch{}let x=i!=null?Number(i):NaN,w=l!=null?Number(l):NaN;return isNaN(x)||isNaN(w)||x<0||x>11?null:{monthIndex:x,year:w,display:`${h[x]}/${w}`}})}};a.\u0275fac=function(n){return new(n||a)(I(k))},a.\u0275prov=v({token:a,factory:a.\u0275fac,providedIn:"root"});let m=a;return m})();var Q=(()=>{let a=class a{constructor(t){this.http=t,this.apiBase=E.apiUrl+"/user_payments/"}desmarcarPagamento(t,n){return this.http.delete(`${this.apiBase}delete_user_payment.php`,{body:{user_id:t,mes_referencia:n}}).pipe(A(this.handleError))}registrarPagamento(t,n,u="pago"){return this.http.post(`${this.apiBase}create_user_payments.php`,{user_id:t,mes_referencia:n,status:u})}getPagamentosPorMes(t){let n=new $;return t&&(n=n.set("mes",t)),this.http.get(`${this.apiBase}get_payments_by_month.php`,{params:n}).pipe(A(this.handleError))}formatarMesParaAPI(t){let n=t.getFullYear(),u=(t.getMonth()+1).toString().padStart(2,"0");return`${n}-${u}`}parseMesString(t){let n=t.split("/");if(n.length===2){let u=["Janeiro","Fevereiro","Mar\xE7o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],h=n[0],b=n[1],g=u.findIndex(d=>d.toLowerCase()===h.toLowerCase());if(g!==-1){let d=(g+1).toString().padStart(2,"0");return`${b}-${d}`}}return this.formatarMesParaAPI(new Date)}atualizarStatusPagamento(t,n){return this.http.patch(`${this.apiBase}update_payments_status.php`,{id:t,status:n})}handleError(t){console.error("Erro no servi\xE7o de pagamentos:",t);let n="Erro ao processar pagamento";return t.error?.error?n=t.error.error:t.message&&(n=t.message),Y(()=>new Error(n))}};a.\u0275fac=function(n){return new(n||a)(I(P))},a.\u0275prov=v({token:a,factory:a.\u0275fac,providedIn:"root"});let m=a;return m})();export{T as a,Q as b};
